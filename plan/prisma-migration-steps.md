# Шаги по созданию миграции и обновлению базы данных

## Анализ текущего состояния

На данный момент в проекте уже добавлены новые модели в схему Prisma:

- `UserPoints` - для хранения баллов пользователя
- `MockInterview` - для мок-собеседований
- `InterviewFeedback` - для отзывов о собеседовании

Также модель `User` уже обновлена с соответствующими связями.

Однако, в терминале видны ошибки:

```
Ошибка при получении собеседований: TypeError: Cannot read properties of undefined (reading 'findMany')
Ошибка при получении баллов пользователя: TypeError: Cannot read properties of undefined (reading 'findUnique')
```

Эти ошибки указывают на то, что клиент Prisma не может найти методы `findMany` и `findUnique`, что может быть вызвано одной из следующих причин:

1. База данных не обновлена с новыми моделями (не применены миграции)
2. Проблемы с подключением к базе данных
3. Проблемы с инициализацией клиента Prisma

## Шаги для решения проблемы

### 1. Создание миграции для обновления базы данных

Для создания миграции с новыми моделями, выполним команду:

```bash
npx prisma migrate dev --name add_mock_interviews
```

Эта команда:

- Создаст новый файл миграции в папке `prisma/migrations`
- Применит миграцию к базе данных
- Сгенерирует новый клиент Prisma на основе обновленной схемы

### 2. Проверка подключения к базе данных

Убедимся, что база данных запущена и доступна. Если используется Docker, проверим статус контейнера:

```bash
docker-compose ps
```

Если контейнер не запущен, запустим его:

```bash
npm run docker:up
```

### 3. Перезапуск приложения

После применения миграции и проверки подключения к базе данных, перезапустим приложение:

```bash
npm run dev
```

### 4. Проверка работоспособности

После перезапуска приложения проверим, что ошибки исчезли и функционал мок-собеседований работает корректно:

- Проверим доступность страницы мок-собеседований
- Проверим возможность создания нового собеседования
- Проверим отображение баллов пользователя

## Дополнительные шаги (если проблема не решена)

### 1. Сброс и повторное применение миграций

Если проблемы с базой данных сохраняются, можно попробовать сбросить и повторно применить все миграции:

```bash
npm run db:reset
```

### 2. Проверка файла lib/prisma.js

Убедимся, что файл `lib/prisma.js` правильно экспортирует клиент Prisma и используется во всех API-эндпоинтах.

### 3. Проверка переменных окружения

Убедимся, что переменная окружения `DATABASE_URL` в файле `.env` или `.env.local` содержит правильный URL для подключения к базе данных.

## Заключение

После выполнения этих шагов база данных должна быть обновлена с новыми моделями, и функционал мок-собеседований должен работать корректно. Если проблемы сохраняются, может потребоваться дополнительный анализ кода API-эндпоинтов и компонентов UI.
