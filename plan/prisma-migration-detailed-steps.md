# Подробные шаги по созданию и применению миграции для моделей мок-собеседований

## Текущая ситуация

В настоящее время в проекте:

1. Модели для мок-собеседований (`UserPoints`, `MockInterview`, `InterviewFeedback`) уже добавлены в схему Prisma (`prisma/schema.prisma`).
2. API-эндпоинты и страницы для работы с мок-собеседованиями уже созданы.
3. Однако, миграция для этих моделей не была создана и применена к базе данных.
4. В результате, при попытке использовать методы `findMany` и `findUnique` для этих моделей возникают ошибки:
   ```
   Ошибка при получении собеседований: TypeError: Cannot read properties of undefined (reading 'findMany')
   Ошибка при получении баллов пользователя: TypeError: Cannot read properties of undefined (reading 'findUnique')
   ```

## Шаг 1: Создание миграции

Для создания миграции с новыми моделями выполним команду:

```bash
npx prisma migrate dev --name add_mock_interviews
```

Эта команда:

- Сравнит текущую схему Prisma с состоянием базы данных
- Создаст новый файл миграции в папке `prisma/migrations` с именем `YYYYMMDDHHMMSS_add_mock_interviews`
- Применит миграцию к базе данных
- Сгенерирует новый клиент Prisma на основе обновленной схемы

## Шаг 2: Проверка созданной миграции

После создания миграции проверим содержимое созданного файла миграции, чтобы убедиться, что он содержит все необходимые операции для создания таблиц:

```bash
cat prisma/migrations/YYYYMMDDHHMMSS_add_mock_interviews/migration.sql
```

Файл миграции должен содержать SQL-команды для создания таблиц:

- `UserPoints`
- `MockInterview`
- `InterviewFeedback`

А также для добавления внешних ключей и индексов.

## Шаг 3: Проверка состояния базы данных

Для проверки состояния базы данных после применения миграции можно использовать Prisma Studio:

```bash
npx prisma studio
```

Prisma Studio запустится на порту 5555 и позволит просмотреть структуру базы данных и данные в таблицах.

## Шаг 4: Перезапуск приложения

После применения миграции перезапустим приложение:

```bash
npm run dev
```

## Шаг 5: Проверка работоспособности API-эндпоинтов

После перезапуска приложения проверим, что ошибки исчезли и API-эндпоинты работают корректно:

1. Проверим эндпоинт для получения списка собеседований:

   ```
   GET /api/mock-interviews
   ```

2. Проверим эндпоинт для получения баллов пользователя:
   ```
   GET /api/user/points
   ```

## Шаг 6: Проверка работоспособности UI

Проверим, что UI для мок-собеседований работает корректно:

1. Проверим отображение кнопки "Пройти мок-собеседование" на главной странице
2. Проверим страницу со списком собеседований
3. Проверим страницу создания нового собеседования
4. Проверим отображение баллов пользователя

## Возможные проблемы и их решения

### 1. Ошибка при создании миграции

Если при создании миграции возникает ошибка, проверьте:

- Синтаксис схемы Prisma
- Наличие конфликтов с существующими таблицами
- Права доступа к базе данных

### 2. Ошибка при применении миграции

Если при применении миграции возникает ошибка, проверьте:

- Состояние базы данных
- Наличие конфликтов с существующими данными
- Права доступа к базе данных

### 3. Ошибки после применения миграции

Если после применения миграции и перезапуска приложения ошибки сохраняются, проверьте:

- Правильность импорта клиента Prisma в API-эндпоинтах
- Наличие ошибок в коде API-эндпоинтов
- Состояние подключения к базе данных

## Дополнительные команды Prisma

### Сброс базы данных и повторное применение всех миграций

```bash
npx prisma migrate reset
```

### Применение существующих миграций без создания новых

```bash
npx prisma migrate deploy
```

### Генерация клиента Prisma без создания миграции

```bash
npx prisma generate
```

### Проверка состояния миграций

```bash
npx prisma migrate status
```

## Заключение

После выполнения этих шагов база данных должна быть обновлена с новыми моделями для мок-собеседований, и функционал мок-собеседований должен работать корректно. Если проблемы сохраняются, может потребоваться дополнительный анализ кода API-эндпоинтов и компонентов UI.
