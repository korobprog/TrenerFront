# Устранение проблем с миграциями Prisma

## Проблема с отсутствующими таблицами в базе данных

Если вы столкнулись с ошибками вида `The table 'public.Account' does not exist in the current database` или другими ошибками, связанными с отсутствием таблиц в базе данных, это может означать, что миграции Prisma не были применены.

## Причины проблемы

1. **Миграции не были выполнены при деплое**

   - Команда `npx prisma migrate deploy` не выполнялась
   - Команда выполнялась, но завершилась с ошибкой

2. **Проблемы с переменными окружения**
   - Переменная `DATABASE_URL` не была доступна при выполнении миграций
   - Значение `DATABASE_URL` было неверным

## Решение проблемы

### Проверка статуса миграций

Чтобы проверить, какие миграции были применены, выполните команду:

```bash
DATABASE_URL=postgresql://user:password@localhost:5432/interview_prep npx prisma migrate status
```

### Применение миграций вручную

Если миграции не были применены, выполните команду:

```bash
DATABASE_URL=postgresql://user:password@localhost:5432/interview_prep npx prisma migrate deploy
```

### Обновление скрипта деплоя

Чтобы избежать подобных проблем в будущем, убедитесь, что в скрипте деплоя переменная `DATABASE_URL` явно указана перед выполнением миграций:

```bash
# Запуск миграций Prisma
echo "Применение миграций базы данных..."
export DATABASE_URL=postgresql://user:password@localhost:5432/interview_prep
npx prisma migrate deploy
```

## Проверка работы авторизации через Google

После применения миграций и перезапуска приложения, авторизация через Google должна работать корректно. Если проблемы остаются, проверьте:

1. Настройки Google OAuth в консоли разработчика Google
2. Переменные окружения `GOOGLE_CLIENT_ID` и `GOOGLE_CLIENT_SECRET`
3. Настройки `NEXTAUTH_URL` и `NEXTAUTH_SECRET`
4. Логи приложения на наличие ошибок

## Важные таблицы для авторизации

Для работы NextAuth с адаптером Prisma необходимы следующие таблицы:

- `User` - информация о пользователях
- `Account` - связь пользователей с провайдерами аутентификации (Google, GitHub и т.д.)
- `Session` - сессии пользователей
- `VerificationToken` - токены для верификации email

Если какая-то из этих таблиц отсутствует, авторизация может не работать.
