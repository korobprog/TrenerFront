# Инструкция по использованию скрипта make-admin-server.js

Этот скрипт предназначен для назначения пользователя администратором непосредственно на сервере. Он использует Docker-команды для доступа к базе данных в контейнере PostgreSQL.

## Копирование скрипта на сервер

### Вариант 1: Использование SCP

```bash
scp scripts/make-admin-server.js root@217.198.6.238:/root/supermock/TrenerFront/scripts/
```

### Вариант 2: Копирование через SSH

1. Подключитесь к серверу по SSH:

   ```bash
   ssh root@217.198.6.238
   ```

2. Создайте файл скрипта:

   ```bash
   cd /root/supermock/TrenerFront/scripts/
   nano make-admin-server.js
   ```

3. Вставьте содержимое скрипта в открывшийся редактор, сохраните файл (Ctrl+O, затем Enter) и выйдите из редактора (Ctrl+X).

## Запуск скрипта на сервере

1. Подключитесь к серверу по SSH:

   ```bash
   ssh root@217.198.6.238
   ```

2. Перейдите в директорию проекта:

   ```bash
   cd /root/supermock/TrenerFront
   ```

3. Запустите скрипт:

   ```bash
   node scripts/make-admin-server.js
   ```

4. Введите email пользователя, которого нужно сделать администратором, когда скрипт запросит эту информацию.

## Что делает скрипт

1. Проверяет Docker-контейнеры и находит контейнер PostgreSQL
2. Проверяет структуру базы данных в контейнере
3. Проверяет существование пользователя с указанным email
4. Проверяет, не является ли пользователь уже администратором
5. Назначает пользователя администратором через SQL-запрос
6. Создает запись в логе административных действий (если таблица лога существует)

## Решение проблем

### Контейнер PostgreSQL не найден

Если скрипт не может найти контейнер PostgreSQL, убедитесь, что Docker запущен и контейнеры работают:

```bash
docker ps
```

Если контейнер остановлен, запустите его:

```bash
docker start trenerfront_postgres
```

### Ошибки доступа к базе данных

Если возникают ошибки доступа к базе данных, проверьте, что пользователь postgres имеет необходимые права:

```bash
docker exec trenerfront_postgres psql -U postgres -c "\du"
```

### Пользователь не найден

Если пользователь с указанным email не найден, скрипт выведет соответствующее сообщение. Убедитесь, что вы ввели правильный email.

Скрипт также попытается найти похожих пользователей по части email до символа @.

## Дополнительная информация

Скрипт использует прямые SQL-запросы к базе данных PostgreSQL через Docker, что позволяет избежать проблем с доступом, которые возникают при использовании SSH-подключения.

Если у вас возникают проблемы с запуском скрипта, убедитесь, что на сервере установлен Node.js:

```bash
node -v
```

Если Node.js не установлен, установите его:

```bash
apt update
apt install -y nodejs npm
```
