const fs = require('fs');
const path = require('path');

console.log('üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API endpoint –¥–ª—è —Å–º–µ–Ω—ã –ø–∞—Ä–æ–ª—è...\n');

// –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞
const apiPath = './pages/api/user/change-password.js';
if (fs.existsSync(apiPath)) {
  console.log('‚úÖ –§–∞–π–ª change-password.js —Å–æ–∑–¥–∞–Ω');

  const content = fs.readFileSync(apiPath, 'utf8');

  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
  console.log('\nüìã –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ API:');

  // –ò–º–ø–æ—Ä—Ç—ã
  if (content.includes('import { getServerSession }')) {
    console.log('   ‚úÖ –ò–º–ø–æ—Ä—Ç getServerSession');
  } else {
    console.log('   ‚ùå –ò–º–ø–æ—Ä—Ç getServerSession –Ω–µ –Ω–∞–π–¥–µ–Ω');
  }

  if (
    content.includes(
      'import { hashPassword, verifyPassword, validatePassword }'
    )
  ) {
    console.log('   ‚úÖ –ò–º–ø–æ—Ä—Ç —É—Ç–∏–ª–∏—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–∞—Ä–æ–ª—è–º–∏');
  } else {
    console.log('   ‚ùå –ò–º–ø–æ—Ä—Ç —É—Ç–∏–ª–∏—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–∞—Ä–æ–ª—è–º–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω');
  }

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Ç–æ–¥–∞
  if (content.includes("req.method !== 'POST'")) {
    console.log('   ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Ç–æ–¥–∞ POST');
  } else {
    console.log('   ‚ùå –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Ç–æ–¥–∞ POST –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
  }

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
  if (content.includes('getServerSession(req, res, authOptions)')) {
    console.log('   ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
  } else {
    console.log('   ‚ùå –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
  }

  // –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
  if (content.includes('currentPassword, newPassword, confirmPassword')) {
    console.log('   ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö');
  } else {
    console.log('   ‚ùå –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
  }

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –ø–∞—Ä–æ–ª–µ–π
  if (content.includes('newPassword !== confirmPassword')) {
    console.log('   ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ –ø–∞—Ä–æ–ª—è –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è');
  } else {
    console.log('   ‚ùå –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –ø–∞—Ä–æ–ª–µ–π –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
  }

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–ª–∏—á–∏—è –æ—Ç —Ç–µ–∫—É—â–µ–≥–æ –ø–∞—Ä–æ–ª—è
  if (content.includes('currentPassword === newPassword')) {
    console.log('   ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–ª–∏—á–∏—è –æ—Ç —Ç–µ–∫—É—â–µ–≥–æ –ø–∞—Ä–æ–ª—è');
  } else {
    console.log('   ‚ùå –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–ª–∏—á–∏—è –æ—Ç —Ç–µ–∫—É—â–µ–≥–æ –ø–∞—Ä–æ–ª—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
  }

  // –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–æ–ª—è
  if (content.includes('validatePassword(newPassword)')) {
    console.log('   ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–∞—Ä–æ–ª—è');
  } else {
    console.log('   ‚ùå –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–∞—Ä–æ–ª—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
  }

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ –ø–∞—Ä–æ–ª—è
  if (content.includes('verifyPassword(currentPassword, user.password)')) {
    console.log('   ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ –ø–∞—Ä–æ–ª—è');
  } else {
    console.log('   ‚ùå –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ –ø–∞—Ä–æ–ª—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
  }

  // –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–∞—Ä–æ–ª—è
  if (content.includes('hashPassword(newPassword)')) {
    console.log('   ‚úÖ –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–∞—Ä–æ–ª—è');
  } else {
    console.log('   ‚ùå –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–∞—Ä–æ–ª—è –Ω–µ –Ω–∞–π–¥–µ–Ω–æ');
  }

  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
  if (content.includes('prisma.user.update')) {
    console.log('   ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö');
  } else {
    console.log('   ‚ùå –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –Ω–∞–π–¥–µ–Ω–æ');
  }

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ OAuth –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
  if (content.includes('–£ –≤–∞—à–µ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞ –Ω–µ—Ç –ø–∞—Ä–æ–ª—è')) {
    console.log('   ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ OAuth –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π');
  } else {
    console.log('   ‚ùå –ü—Ä–æ–≤–µ—Ä–∫–∞ OAuth –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
  }

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
  if (content.includes('try {') && content.includes('catch (error)')) {
    console.log('   ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫');
  } else {
    console.log('   ‚ùå –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
  }

  // –ó–∞–∫—Ä—ã—Ç–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å –ë–î
  if (content.includes('prisma.$disconnect()')) {
    console.log('   ‚úÖ –ó–∞–∫—Ä—ã—Ç–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö');
  } else {
    console.log('   ‚ùå –ó–∞–∫—Ä—ã—Ç–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö –Ω–µ –Ω–∞–π–¥–µ–Ω–æ');
  }

  console.log('\nüîí –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:');

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Å—Å–∏–∏
  if (content.includes('if (!session || !session.user)')) {
    console.log('   ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Å—Å–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
  } else {
    console.log('   ‚ùå –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Å—Å–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
  }

  // –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –ø–æ–ª–µ–π
  if (
    content.includes(
      'if (!currentPassword || !newPassword || !confirmPassword)'
    )
  ) {
    console.log('   ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π');
  } else {
    console.log('   ‚ùå –í–∞–ª–∏–¥–∞—Ü–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
  }

  // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ bcrypt
  if (content.includes('verifyPassword') && content.includes('hashPassword')) {
    console.log('   ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ bcrypt –¥–ª—è —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è');
  } else {
    console.log('   ‚ùå –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ bcrypt –Ω–µ –Ω–∞–π–¥–µ–Ω–æ');
  }

  console.log('\nüìù –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤ API:');

  // –£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç
  if (
    content.includes('success: true') &&
    content.includes('–ü–∞—Ä–æ–ª—å —É—Å–ø–µ—à–Ω–æ –∏–∑–º–µ–Ω–µ–Ω')
  ) {
    console.log('   ‚úÖ –£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç');
  } else {
    console.log('   ‚ùå –£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω');
  }

  // –û—à–∏–±–∫–∏
  if (content.includes('success: false') && content.includes('error:')) {
    console.log('   ‚úÖ –û—Ç–≤–µ—Ç—ã —Å –æ—à–∏–±–∫–∞–º–∏');
  } else {
    console.log('   ‚ùå –û—Ç–≤–µ—Ç—ã —Å –æ—à–∏–±–∫–∞–º–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã');
  }

  console.log('\nüéâ API endpoint –¥–ª—è —Å–º–µ–Ω—ã –ø–∞—Ä–æ–ª—è —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ!');
  console.log('\nüìã –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:');
  console.log('   1. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
  console.log(
    '   2. ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (currentPassword, newPassword, confirmPassword)'
  );
  console.log('   3. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ –ø–∞—Ä–æ–ª—è —Å –ø–æ–º–æ—â—å—é bcrypt');
  console.log(
    '   4. ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–∞—Ä–æ–ª—è (–º–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤, –±—É–∫–≤—ã –∏ —Ü–∏—Ñ—Ä—ã)'
  );
  console.log('   5. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ –ø–∞—Ä–æ–ª—è –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è');
  console.log('   6. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–ª–∏—á–∏—è –Ω–æ–≤–æ–≥–æ –ø–∞—Ä–æ–ª—è –æ—Ç —Ç–µ–∫—É—â–µ–≥–æ');
  console.log('   7. ‚úÖ –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–∞—Ä–æ–ª—è');
  console.log('   8. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö');
  console.log('   9. ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç OAuth –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π');
  console.log('   10. ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ HTTP —Å—Ç–∞—Ç—É—Å—ã');

  console.log('\nüîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:');
  console.log('   ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Å—Å–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
  console.log('   ‚úÖ –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π —Å –ø–æ–º–æ—â—å—é bcrypt');
  console.log('   ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö');
  console.log('   ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ –ø–∞—Ä–æ–ª—è –ø–µ—Ä–µ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º');
  console.log('   ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è OAuth –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π');

  console.log('\nüì° API Endpoint:');
  console.log('   POST /api/user/change-password');
  console.log('   Body: { currentPassword, newPassword, confirmPassword }');
  console.log(
    '   Response: { success: boolean, message?: string, error?: string }'
  );

  console.log('\nüöÄ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!');
} else {
  console.log('‚ùå –§–∞–π–ª change-password.js –Ω–µ –Ω–∞–π–¥–µ–Ω');
}
