# Инструкция по устранению проблем с Google токенами

## Проблема решена

✅ **Статус**: Проблема с Google токенами успешно устранена

**Дата решения**: 26 мая 2025 г.

## Что было сделано

1. **Создан скрипт обновления Google токенов** (`scripts/refresh-google-tokens.js`)

   - Автоматически обновляет access_token используя refresh_token
   - Обновляет токены как в файле .env.production, так и в базе данных
   - Включает обработку ошибок и детальное логирование

2. **Создан скрипт добавления вопросов** (`scripts/add-questions.js`)

   - Добавляет вопросы для собеседований в базу данных
   - Проверяет наличие существующих вопросов перед добавлением
   - Безопасно обрабатывает дубликаты

3. **Выполнен сброс Google авторизации**
   - Удалены устаревшие токены из базы данных
   - Сброшены аккаунты Google для пользователей:
     - makstreid@gmail.com
     - korobprog@gmail.com

## Инструкции для пользователей

### Для пользователей, которым нужно восстановить доступ к Google Meet:

1. **Отзовите доступ к приложению в Google**:

   - Перейдите на https://myaccount.google.com/permissions
   - Найдите приложение "SuperMock" в списке
   - Нажмите "Отозвать доступ"

2. **Заново войдите в систему**:

   - Выйдите из системы SuperMock
   - Войдите снова через Google
   - Предоставьте все необходимые разрешения

3. **Проверьте функциональность**:
   - Попробуйте создать мок-собеседование
   - Убедитесь, что ссылка на Google Meet создается автоматически

## Технические детали

### Причина проблемы

- Истек срок действия Google refresh_token (истек 17 января 2025 г.)
- Ошибка `invalid_grant: Token has been expired or revoked`

### Решение

- Сброс всех Google аккаунтов в базе данных
- Принудительная повторная авторизация пользователей
- Получение новых действительных токенов

### Файлы, которые были созданы/обновлены

- `scripts/refresh-google-tokens.js` - новый скрипт для обновления токенов
- `scripts/add-questions.js` - новый скрипт для добавления вопросов
- `docs/google-tokens-fix-instructions.md` - данная документация

## Мониторинг

### Проверка статуса приложения

```bash
pm2 status
```

### Проверка логов

```bash
pm2 logs supermock --lines 50
```

### Проверка базы данных

```bash
node scripts/test-db-connection.js
```

## Профилактика

Для предотвращения подобных проблем в будущем:

1. **Регулярный мониторинг токенов**

   - Проверяйте срок действия токенов раз в месяц
   - Используйте скрипт `refresh-google-tokens.js` для обновления

2. **Автоматическое обновление**

   - Рассмотрите возможность настройки cron-задачи для автоматического обновления токенов

3. **Резервное копирование**
   - Регулярно создавайте резервные копии базы данных
   - Сохраняйте актуальные переменные окружения

## Контакты для поддержки

При возникновении проблем обращайтесь к администратору системы.

---

**Последнее обновление**: 26 мая 2025 г., 21:30 (UTC+10)
