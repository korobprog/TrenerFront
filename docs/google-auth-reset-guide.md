# Инструкция по восстановлению доступа к Google API

## Проблема

В системе была обнаружена проблема с токенами авторизации Google. Это может приводить к следующим ошибкам:

- "Не удалось автоматически создать ссылку на Google Meet"
- "Токены Google не найдены для пользователя"
- "invalid_grant" или "Token has been expired or revoked"

## Решение

Для восстановления доступа к Google API необходимо:

1. Администратору выполнить скрипт сброса токенов:

   ```bash
   node scripts/reset-google-auth.js
   ```

2. Пользователям, указанным в списке после выполнения скрипта, необходимо:

   - Выйти из системы
   - Зайти на страницу https://myaccount.google.com/permissions
   - Найти приложение в списке и отозвать доступ (нажать "Отозвать доступ")
   - Снова войти в систему через Google

3. После повторной авторизации через Google будут созданы новые токены с корректными значениями, и функциональность Google Meet будет восстановлена.

## Технические детали

Проблема возникает из-за отсутствия или недействительности refresh_token в базе данных. При авторизации через Google необходимо получить новый refresh_token, который позволит системе автоматически обновлять access_token.

Скрипт `reset-google-auth.js` удаляет существующие записи аккаунтов Google в базе данных, что позволяет при повторной авторизации создать новые записи с корректными токенами.

## Дополнительные шаги для обновления схемы базы данных

После обнаружения проблемы с полем `refresh_token_expires_in`, необходимо выполнить следующие шаги:

1. Обновить схему базы данных, выполнив миграцию:

   ```bash
   npx prisma migrate dev --name add_refresh_token_expires_in
   ```

2. Перезапустить сервер:

   ```bash
   npm run dev
   ```

3. После этого повторить процесс авторизации через Google.
