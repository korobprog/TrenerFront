# Исправление ошибки входа по логину и паролю

## Проблема

При нажатии на кнопку "Войти с логином и паролем" на странице входа возникала ошибка "Произошла ошибка при входе. Пожалуйста, попробуйте снова."

## Причина

Кнопка "Войти с логином и паролем" на главной странице входа (`/auth/signin`) вызывала `signIn('credentials')` без передачи учетных данных (логина и пароля), что приводило к ошибке в NextAuth.

## Решение

### 1. Создана отдельная страница для входа по логину и паролю

- **Файл**: `pages/auth/credentials.js`
- **Описание**: Полноценная форма входа с полями для логина/email и пароля
- **Функциональность**:
  - Валидация полей
  - Обработка ошибок
  - Индикатор загрузки
  - Перенаправление после успешного входа

### 2. Созданы стили для страницы входа

- **Файл**: `styles/auth/SignInModal.module.css`
- **Описание**: Современный дизайн с градиентным фоном и анимациями
- **Особенности**:
  - Адаптивный дизайн
  - Анимации появления
  - Стили для состояний загрузки и ошибок

### 3. Обновлена главная страница входа

- **Файл**: `pages/auth/signin.js`
- **Изменение**: Кнопка "Войти с логином и паролем" теперь перенаправляет на `/auth/credentials` вместо попытки прямого входа

### 4. Создан тестовый пользователь

- **Email**: `test@example.com`
- **Пароль**: `testpassword123`
- **Скрипт**: `test-credentials-login.js`

## Как протестировать исправление

### Вариант 1: Через браузер

1. Откройте http://localhost:3000/auth/signin
2. Нажмите кнопку "Войти с логином и паролем"
3. Введите тестовые данные:
   - **Email**: `test@example.com`
   - **Пароль**: `testpassword123`
4. Нажмите "Войти"
5. Проверьте успешное перенаправление на главную страницу

### Вариант 2: Прямой доступ к странице входа

1. Откройте http://localhost:3000/auth/credentials
2. Введите тестовые данные
3. Проверьте успешный вход

## Обработка ошибок

Страница входа обрабатывает следующие типы ошибок:

- `CredentialsSignin` - неверный логин или пароль
- `OAuthAccountNotLinked` - аккаунт не связан
- `AccessDenied` - доступ запрещен (заблокированный пользователь)
- `Configuration` - ошибка конфигурации

## Файлы, затронутые исправлением

1. **Новые файлы**:

   - `pages/auth/credentials.js` - страница входа по логину и паролю
   - `styles/auth/SignInModal.module.css` - стили для страницы входа
   - `test-credentials-login.js` - скрипт создания тестового пользователя
   - `test-credentials-signin.js` - тест функциональности входа

2. **Измененные файлы**:
   - `pages/auth/signin.js` - обновлена логика кнопки credentials

## Дополнительные возможности

### Создание нового тестового пользователя

```bash
node test-credentials-login.js
```

### Проверка существующих пользователей

```javascript
// В консоли браузера или через Prisma Studio
const users = await prisma.user.findMany({
  where: { password: { not: null } },
  select: { id: true, email: true, name: true, role: true },
});
```

## Безопасность

- Пароли хешируются с помощью bcrypt (12 раундов)
- Проверка блокировки пользователя
- Валидация входных данных
- Защита от CSRF через NextAuth
- Проверка настроек аутентификации пользователя

## Совместимость

Исправление полностью совместимо с существующей системой аутентификации:

- OAuth провайдеры (Google, GitHub) работают как прежде
- Email магические ссылки работают как прежде
- Система ролей и разрешений не затронута
- Настройки аутентификации пользователей учитываются

## Заключение

Проблема с входом по логину и паролю полностью решена. Теперь пользователи могут:

1. Выбрать способ входа на главной странице
2. Перейти на специальную страницу для ввода логина и пароля
3. Получить понятные сообщения об ошибках
4. Успешно войти в систему с правильными учетными данными
